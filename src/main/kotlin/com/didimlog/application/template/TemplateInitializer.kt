package com.didimlog.application.template

import com.didimlog.domain.enums.TemplateOwnershipType
import com.didimlog.domain.repository.TemplateRepository
import com.didimlog.domain.template.Template
import jakarta.annotation.PostConstruct
import org.springframework.stereotype.Component

/**
 * ì‹œìŠ¤í…œ í…œí”Œë¦¿ ì´ˆê¸°í™” ì»´í¬ë„ŒíŠ¸
 * ì• í”Œë¦¬ì¼€ì´ì…˜ ì‹œì‘ ì‹œ ì‹œìŠ¤í…œ í…œí”Œë¦¿ì„ ìƒì„±í•œë‹¤.
 */
@Component
class TemplateInitializer(
    private val templateRepository: TemplateRepository
) {

    @PostConstruct
    fun initializeSystemTemplates() {
        initializeSimpleTemplate()
        initializeDetailTemplate()
    }

    /**
     * ìš”ì•½(Simple) ì‹œìŠ¤í…œ í…œí”Œë¦¿ì„ ì´ˆê¸°í™”í•œë‹¤.
     */
    private fun initializeSimpleTemplate() {
        val existingTemplate = templateRepository.findByType(TemplateOwnershipType.SYSTEM)
            .firstOrNull { it.title == "Simple(ìš”ì•½)" }
        
        if (existingTemplate != null) {
            return
        }

        val simpleContent = """
# ğŸ† {{problemTitle}}

## ğŸ”‘ í•µì‹¬ ë¡œì§ (Key Logic)

- í’€ì´ì˜ í•µì‹¬ ê³µì‹ì´ë‚˜ ì ‘ê·¼ë²•ì„ í•œ ì¤„ë¡œ ì ì–´ì£¼ì„¸ìš”.

## ğŸ’¡ ì˜¤ëŠ˜ì˜ ë°°ì›€ (Learnings)

- ì‹¤ìˆ˜í–ˆê±°ë‚˜ ìƒˆë¡œ ì•Œê²Œ ëœ ì ì„ ì ì–´ì£¼ì„¸ìš”.

## ì œì¶œí•œ ì½”ë“œ

```{{language}}
ì—¬ê¸°ì— ì½”ë“œë¥¼ ì‘ì„±í•˜ì„¸ìš”.
```

---
[ë¬¸ì œ ë§í¬]({{link}})
Generated by DidimLog
        """.trimIndent()

        val simpleTemplate = Template(
            studentId = null,
            title = "Simple(ìš”ì•½)",
            content = simpleContent,
            type = TemplateOwnershipType.SYSTEM,
            isDefault = false
        )

        templateRepository.save(simpleTemplate)
    }

    /**
     * ìƒì„¸(Detail) ì‹œìŠ¤í…œ í…œí”Œë¦¿ì„ ì´ˆê¸°í™”í•œë‹¤.
     */
    private fun initializeDetailTemplate() {
        val existingTemplate = templateRepository.findByType(TemplateOwnershipType.SYSTEM)
            .firstOrNull { it.title == "Detail(ìƒì„¸)" }
        
        if (existingTemplate != null) {
            return
        }

        val detailContent = """
# ğŸ† {{problemTitle}} í•´ê²° íšŒê³ 

## 1. ì ‘ê·¼ ë°©ë²• (Approach)

- ë¬¸ì œë¥¼ í•´ê²°í•˜ê¸° ìœ„í•´ ì–´ë–¤ ì•Œê³ ë¦¬ì¦˜ì´ë‚˜ ìë£Œêµ¬ì¡°ë¥¼ ì„ íƒí–ˆë‚˜ìš”?
- í’€ì´ì˜ í•µì‹¬ ë¡œì§ì„ í•œ ì¤„ë¡œ ìš”ì•½í•´ ë³´ì„¸ìš”.

## 2. ë³µì¡ë„ ë¶„ì„ (Complexity)

- ì‹œê°„ ë³µì¡ë„: O(?)
- ê³µê°„ ë³µì¡ë„: O(?)

## 3. ë¦¬íŒ©í† ë§ í¬ì¸íŠ¸ (Refactoring)

- ê°œì„ í•  ìˆ˜ ìˆëŠ” ë³€ìˆ˜/í•¨ìˆ˜ëª…, ì¤‘ë³µ ì œê±°, ë¡œì§ ë‹¨ìˆœí™” í¬ì¸íŠ¸ë¥¼ ì ì–´ë³´ì„¸ìš”.

## 4. ë‹¤ë¥¸ í’€ì´ì™€ ë¹„êµ (Comparison)

- ë‹¤ë¥¸ ì‚¬ëŒì˜ í’€ì´(ë˜ëŠ” í‘œì¤€ í’€ì´)ì™€ ë¹„êµí•´ì„œ ë‚´ í’€ì´ì˜ ì¥ë‹¨ì ì„ ì •ë¦¬í•´ë³´ì„¸ìš”.

## 5. ë‹¤ìŒ ì•¡ì…˜ (Next)

- ë‹¤ìŒì— ê°™ì€ ìœ í˜•ì„ ë§Œë‚˜ë©´ ì–´ë–¤ ì ì„ ë” ì˜í• ì§€ í•œ ì¤„ë¡œ ì ì–´ë³´ì„¸ìš”.

## ì œì¶œí•œ ì½”ë“œ

```{{language}}
ì—¬ê¸°ì— ì½”ë“œë¥¼ ì‘ì„±í•˜ì„¸ìš”.
```

---
[ë¬¸ì œ ë§í¬]({{link}}) | í‹°ì–´: {{tier}}
Generated by DidimLog
        """.trimIndent()

        val detailTemplate = Template(
            studentId = null,
            title = "Detail(ìƒì„¸)",
            content = detailContent,
            type = TemplateOwnershipType.SYSTEM,
            isDefault = false
        )

        templateRepository.save(detailTemplate)
    }
}
